# =============================================================================
# GitHub Secrets Template
# =============================================================================
# Purpose: Template pro vytvoření GitHub repository secrets
# Usage: Tento soubor slouží jako reference - secrets se NEVYTVÁŘEJÍ v .env
#        Musíte je nastavit v GitHub UI: Settings → Secrets and variables → Actions
# =============================================================================

# -----------------------------------------------------------------------------
# BIGQUERY_CREDENTIALS (JEDINÝ potřebný secret)
# -----------------------------------------------------------------------------
# Type: JSON (celý service account key file)
# Source: ingestion/credentials/dwhhbbi-credentials.json
# Format: Celý JSON object (včetně {}, quotes, atd.)
#
# Jak získat hodnotu:
# Windows PowerShell:
#   Get-Content "ingestion\credentials\dwhhbbi-credentials.json" | Set-Clipboard
# Nebo:
#   cat ingestion/credentials/dwhhbbi-credentials.json
#
# Workflow použití:
#   1. GitHub Secret BIGQUERY_CREDENTIALS obsahuje celý JSON
#   2. Workflow vytvoří soubor: ingestion/credentials/dwhhbbi-credentials.json
#   3. Workflow nastaví GOOGLE_APPLICATION_CREDENTIALS env var
#   4. dlt a dbt automaticky najdou credentials přes tuto env var
#
# Výhody tohoto přístupu:
#   ✅ Pouze 1 secret místo 4 separátních
#   ✅ Žádné problémy s TOML escapováním newlines v private_key
#   ✅ Standard Google Cloud best practice
#   ✅ Funguje s dlt i dbt bez extra konfigurace
#
# Očekávaný formát:
BIGQUERY_CREDENTIALS='{
  "type": "service_account",
  "project_id": "dwhhbbi",
  "private_key_id": "xxxxx",
  "private_key": "-----BEGIN PRIVATE KEY-----\\nxxxx\\n-----END PRIVATE KEY-----\\n",
  "client_email": "service-account@dwhhbbi.iam.gserviceaccount.com",
  "client_id": "xxxxx",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/..."
}'

# =============================================================================
# INSTRUKCE PRO VYTVOŘENÍ SECRETU V GITHUB
# =============================================================================
#
# 1. Navigate to repository on GitHub
# 2. Settings → Secrets and variables → Actions
# 3. Click "New repository secret"
# 4. Vytvoř 1 secret:
#    Name: BIGQUERY_CREDENTIALS
#    Value: celý JSON obsah (bez outer quotes)
# 5. Click "Add secret"
#
# 6. Verify secret existuje v seznamu
#
# =============================================================================
# TECHNICKÉ DETAILY IMPLEMENTACE
# =============================================================================
#
# Workflow kroky (.github/workflows/stocks-pipeline.yml):
#
# Step 4 (Job 1): Create credentials file
#   mkdir -p ingestion/credentials
#   echo '${{ secrets.BIGQUERY_CREDENTIALS }}' > ingestion/credentials/dwhhbbi-credentials.json
#
# Step 5 (Job 1): Set GOOGLE_APPLICATION_CREDENTIALS
#   echo "GOOGLE_APPLICATION_CREDENTIALS=${{ github.workspace }}/ingestion/credentials/dwhhbbi-credentials.json" >> $GITHUB_ENV
#
# Step 5 (Job 1): Create minimální secrets.toml pro dlt
#   echo "[destination.bigquery]" > ingestion/.dlt/secrets.toml
#   echo 'location = "US"' >> ingestion/.dlt/secrets.toml
#   # dlt automaticky najde credentials z GOOGLE_APPLICATION_CREDENTIALS
#
# Step 4 (Job 2): Set DBT_BIGQUERY_KEYFILE pro dbt
#   echo "DBT_BIGQUERY_KEYFILE=${{ github.workspace }}/ingestion/credentials/dwhhbbi-credentials.json" >> $GITHUB_ENV
#   # dbt profiles.yml používá env_var('DBT_BIGQUERY_KEYFILE')
#
# =============================================================================
# SECURITY NOTES
# =============================================================================
#
# ⚠️ NIKDY necommitujte tento soubor s reálnými hodnotami do gitu!
# ⚠️ Tento template je pouze pro referenci (.env.example je v .gitignore)
# ⚠️ Skutečné hodnoty musí být pouze v GitHub Secrets (encrypted)
#
# Best Practices:
# - Rotate service account keys každých 90 dní
# - Use principle of least privilege (pouze potřebné permissions)
# - Never share secrets přes email/Slack/Discord
# - Monitor service account activity v GCP Console
# - Enable audit logging pro service account usage
#
# =============================================================================
